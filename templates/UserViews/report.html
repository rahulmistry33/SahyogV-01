{% load static %}

<!DOCTYPE html>
<html>

<head>
	<title>Sahyog</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<!-- GOOGLE FONTS -->
	<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500|Poppins:400,500,600,700|Roboto:400,500"
		rel="stylesheet" />
	<link href="https://cdn.materialdesignicons.com/3.0.39/css/materialdesignicons.min.css" rel="stylesheet" />

	

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'style.css'%}"> 
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
    integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
    crossorigin="" />

<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
    integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
    crossorigin=""></script>
<script src="https://cdn-geoweb.s3.amazonaws.com/esri-leaflet/0.0.1-beta.5/esri-leaflet.js"></script>

<script
    src="https://cdn-geoweb.s3.amazonaws.com/esri-leaflet-geocoder/0.0.1-beta.5/esri-leaflet-geocoder.js"></script>
<link rel="stylesheet" type="text/css"
    href="https://cdn-geoweb.s3.amazonaws.com/esri-leaflet-geocoder/0.0.1-beta.5/esri-leaflet-geocoder.css">
<link rel="stylesheet" href="{% static 'styles.css'%}">

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
	<!-- SLEEK CSS -->
    <link id="sleek-css" rel="stylesheet" href="{% static 'assets-analytics/css/sleek.css' %}" />
    <!-- PLUGINS CSS STYLE -->
	<link href="{% static 'assets-analytics/plugins/toaster/toastr.min.css' %}" rel="stylesheet" />
	<link href="{% static 'assets-analytics/plugins/nprogress/nprogress.css'%}" rel="stylesheet" />
	<link href="{% static 'assets-analytics/plugins/flag-icons/css/flag-icon.min.css'%}" rel="stylesheet" />
	<link href="{% static 'assets-analytics//plugins/jvectormap/jquery-jvectormap-2.0.3.css'%}" rel="stylesheet" />
	<link href="{% static 'assets-analytics/plugins/ladda/ladda.min.css'%}" rel="stylesheet" />
	<link href="{% static 'assets-analytics/plugins/select2/css/select2.min.css'%}" rel="stylesheet" />
	<link href="{% static 'assets-analytics/plugins/daterangepicker/daterangepicker.css'%}" rel="stylesheet" />

</head>
<style>
        .invi {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 1;

    }

    .card {
        cursor: pointer;
        /* margin: 20px !important; */
    }

    .card:hover {
        background-color: #000 !important;
    }
	.mdi {
		color: #ffaa00 !important;
	}
    body,
    html {
      background: url("{% static 'india1.jpg' %}");
      /* background-repeat: no-repeat;
      background-size: cover;
      background-attachment: fixed; */
      
      background-position: center;
    }
  
    #overlay {
      position: fixed;
      /* display: none; */
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 2;
      cursor: pointer;
      text-align: center;
    }
  
  
    .btn {
      background-color: transparent;
      border: 2px solid #ff9800;
      border-color: #ff9800;
      padding: 10px;
      margin: 10px;
      font-family: georgia;
      border-radius: 10px;
      /*margin-top: 50vh;*/
      font-size: 20px;
    }
  
    .btn:hover {
      background-color: #ffc400;
	  border-color: #ffc400;
    }

    .sos{
        background-color: black;
        border-color: red;
        color: white;
    }
    .sos:hover{
        background-color: red;
        color: white;
    }
  </style>
<body class="sidebar-fixed sidebar-dark header-light header-fixed" id="body">
	<script>
		NProgress.configure({ showSpinner: false });
		NProgress.start();
	</script>

	<div class="mobile-sticky-body-overlay"></div>
	<div class="wrapper">
		<aside class="left-sidebar bg-sidebar">
			<div id="sidebar" class="sidebar sidebar-with-footer">
				<!-- Aplication Brand -->
				<div style="background-color: #ffaa00;" class="app-brand">
					<a href="/index.html">

						<span class="brand-name">Sahyog</span>
					</a>
				</div>
				<!-- begin sidebar scrollbar -->
				<div class="sidebar-scrollbar">

					<!-- sidebar menu -->
					<ul class="nav sidebar-inner" id="sidebar-menu">



						<li class="has-sub  expand">
							<a class="sidenav-item-link" href="/sahyog/index/" >
								<i class="mdi mdi-view-dashboard-outline"></i>
								<span class="nav-text">Home</span>
							</a>

						</li>




						<li class="has-sub active">
                            <a class="sidenav-item-link" href="/sahyog/report/" >
                                <i class="mdi mdi-image-filter-none"></i>
								
								<span class="nav-text">Report</span>
							</a>


						</li>

                        

						<li class="has-sub">
							<a class="sidenav-item-link" href="/sahyog/validate/" >
								<i class="mdi mdi-check"></i>
								<span class="nav-text">Validate</span>
							</a>

                        </li>

					

                        <li class="has-sub">
							<a class="sidenav-item-link" href="/sahyog/safey/">
								<i class="mdi mdi-map-marker-multiple"></i>
								<span class="nav-text">Safe Route</span>
							</a>


						</li>



                        <li class="has-sub">
							<a class="sidenav-item-link" href="/sahyog/analytics" >
								<i class="mdi mdi-chart-line"></i>
								<span class="nav-text">Analytics</span>
							</a>
						</li>

                        <li class="has-sub">
                            <a class="sidenav-item-link"  href="/sahyog/logout">
                                <i class="mdi mdi-logout"></i>
                                    <span class="nav-text">Logout</span>
                            </a>
                            </li>


                            

						









					</ul>

				</div>

				<hr class="separator" />

				<div class="sidebar-footer">
					<div class="sidebar-footer-content">
						<h6 class="text-uppercase">
							Cases Closed <span class="float-right">72%</span>
						</h6>
						<div class="progress progress-xs">
							<div class="progress-bar active" style="width: 72%;" role="progressbar"></div>
						</div>
						<h6 class="text-uppercase">
							Crimes Validated<span class="float-right">65%</span>
						</h6>
						<div class="progress progress-xs">
							<div class="progress-bar progress-bar-warning" style="width: 65%;" role="progressbar"></div>
						</div>
					</div>
				</div>
			</div>
		</aside>



		<div class="page-wrapper">
			<!-- Header -->
			<header class="main-header " id="header">
				<nav style="background-color: transparent; border: none;" class="navbar navbar-static-top navbar-expand-lg">
					<!-- Sidebar toggle button -->
					<button style="background-color: black; border: none; color: white;" id="sidebar-toggler" class="sidebar-toggle">
						<span class="sr-only">Toggle navigation</span>
					</button>
					<!-- search form -->
					<div class="search-form d-none d-lg-inline-block">
						<div class="input-group">

						</div>
						<!-- <div id="search-results-container">
							<ul id="search-results"></ul>
						</div> -->
					</div>

					<div class="navbar-right ">
						<ul class="nav navbar-nav">
                            <a href="/sahyog/SOS/"  class="btn sos">SOS</a>
							<!-- <a href="/sahyog/register/" class="btn btn-dark">Register</a> -->
							<a href="" class="btn btn-dark">{{username}}</a>
                      
                            
						</ul>
					</div>
				</nav>


			</header>
			<div class="content-wrapper">
				<div class="content">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div id="mapid" class="panel-body">
                    </div>
                </div>
            </div>
        </div>
        <br>
        <div class="row">

            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading" style="background-color:  black; padding: 20px; color: white;">
                        Crime Details
                    </div>

                    <div class="panel-body" style="background-color: black; color: white; padding: 20px;">

                        <form id="reportcrime" action="{% url 'reportCrime' %}" method="POST">
                            {% csrf_token %}
                            <label for="crimeLocation">Crime Location </label>
                            <input class="form-control" type="text" name="location" id="location" readonly>
                            <br>
                            <label for="crimeType">Choose Crime Type*</label>
                            <select name="crimeType" class="form-control">
                                <option>Theft</option>
                                <option>Assault</option>
                                <option>Bombing</option>
                                <option>Burglary</option>
                                <option>Disturbance of Peace</option>
                                <option>Alcohol Violations</option>
                                <option>Fraud</option>
                                <option>Homicide</option>
                                <option>Vehicle Theft</option>
                                <option>Robery</option>
                                <option>Sex Crimes</option>
                            </select>
                            <br>

                            <label for="crimeLevel">Choose Crime Severity Level (1-least severe)</label><br>

                            <label class="radio-inline"><input type="radio" name="crimeLevel"value="1" checked>1</label>
                            <label class="radio-inline"><input type="radio" name="crimeLevel" value="2">2</label>
                            <label class="radio-inline"><input type="radio" name="crimeLevel"value="3" >3</label>
                            <br><br>
                            <label for="crimeImage">Upload Crime Photo (Optional)</label><br>
                            
                            <input id="fileInput" type="file" style="display:none;" />
                            
                            <button class="btn btn-dark" type="button" name="crimeImage"
                                style=" color:white;" onclick="document.getElementById('fileInput').click();">Choose File</button>
                                <div id="fileName"></div>
                            <br><br>
                            <script>
                              var input = document.getElementById( 'fileInput' );
                                var infoArea = document.getElementById( 'fileName' );

                                input.addEventListener( 'change', showFileName );

                                function showFileName( event ) {
                                
                                // the change event gives us the input it occurred in 
                                var input = event.srcElement;
                                
                                // the input has an array of files in the `files` property, each one has a name that you can use. We're just using the name here.
                                var fileName = input.files[0].name;
                                
                                // use fileName however fits your app best, i.e. add it into a div
                                infoArea.textContent = 'File uploaded: ' + fileName;
                                }
                            
                            </script>
                            <div class="form-group">
                                <label style="color: white;" for="crimeDetails">Additional Details (Optional)</label>
                                <textarea class="form-control" rows="4" name="crimeDetails"></textarea>
                            </div>
                            <br>
                            <input type="submit" class="btn btn-dark"
                                style=" color:white; font-size: 20px; width: 300px;">
                        </form>
                    </div>
                </div>
            </div>
        </div>



         
</div>
</div>
</div>
</div>





<script>
    var latlng;
       var mymap;
       var crimeLocation;
       var coodsLat = [];
       var coodsLng = [];
       // Leaflet Colored Markers :D
       // green colors
       var greenIcon = new L.Icon({
           iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
           shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
           iconSize: [25, 41],
           iconAnchor: [12, 41],
           popupAnchor: [1, -34],
           shadowSize: [41, 41]
           });
       // red color
       var redIcon = new L.Icon({
           iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
           shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
           iconSize: [25, 41],
           iconAnchor: [12, 41],
           popupAnchor: [1, -34],
           shadowSize: [41, 41]
           });
       
       // blue colors
       var blueIcon = new L.Icon({
           iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
           shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
           iconSize: [25, 41],
           iconAnchor: [12, 41],
           popupAnchor: [1, -34],
           shadowSize: [41, 41]
           });
       

       navigator.geolocation.getCurrentPosition(function (location) {
           latlng = new L.LatLng(location.coords.latitude, location.coords.longitude);
           mymap = L.map('mapid').setView(latlng, 13)

           L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
               maxZoom: 20,
               subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
           }).addTo(mymap);
           L.control.scale().addTo(mymap);


           var searchControl = new L.esri.Controls.Geosearch().addTo(mymap);
           var results = new L.LayerGroup().addTo(mymap);

           searchControl.on('results', function (data) {
               results.clearLayers();
               for (var i = data.results.length - 1; i >= 0; i--) {
                   results.addLayer(L.marker(data.results[i].latlng));
                   coodsLat.push(data.results[i].latlng.lat);
                   coodsLng.push(data.results[i].latlng.lng);
                   console.log(data.results[i]);
                   document.getElementById("location").value = data.results[i].text;
                   crimeLocation = { "lat": data.results[i].latlng.lat, "lng": data.results[i].latlng.lng }
               }
           });

           // L.marker(latlng).addTo(mymap);

       });


       if (typeof (EventSource) !== "undefined") {
           var source = new EventSource("{% url 'SSE' %}");

           source.onmessage = function (event) {

               console.log((JSON.parse(event.data)));
               JSON.parse(event.data).forEach((item, index) => {
                   if (!coodsLat.includes(item.lat) && !coodsLng.includes(item.lng)) {
                       console.log('nope');
                       coodsLat.push(item.lat);
                       coodsLng.push(item.lng);
                       var temp = new L.LatLng(item.lat, item.lng);
                       let details = item.crimeDetails;
                       let type = item.crimeType;
                       
                       
                       if(item.crimeLevel === "1"){
                           L.marker(temp,{icon:blueIcon}).bindPopup(`<b>${type}</b><br>${details}.`).openPopup().addTo(mymap);
                           // console.log(`<b>${type}</b><br>${details}.`);

                       }
                       else if(item.crimeLevel === "2")
                           L.marker(temp,{icon:greenIcon}).bindPopup(`<b>${type}</b><br>${details}.`).openPopup().addTo(mymap);
                       else if(item.crimeLevel === "3")
                           L.marker(temp,{icon:redIcon}).bindPopup(`<b>${type}</b><br>${details}.`).openPopup().addTo(mymap);
                       
                       



                   }

               });

           };
       } else {
           console.log("Error");
       }

       $(document).on('submit', '#reportcrime', function (event) {
           event.preventDefault();
           var $form = $(this),
               url = $form.attr('action');
           var paramArr = $("#reportcrime").serializeArray();
           paramArr.push({ name: "lat", value: crimeLocation.lat });
           paramArr.push({ name: "lng", value: crimeLocation.lng });
           $.post(url, $.param(paramArr), function (result) {
               alert('success');
           });
           return false;
       });

       $(document).on('submit', '#SOSForm', function (event) {
           event.preventDefault();
           var $form = $(this),
               url = $form.attr('action');
           var paramArr = $("#SOSForm").serializeArray();
           paramArr.push({ name: "test", value: "lalala" });

           $.post(url, $.param(paramArr), function (result) {
               alert('success');
           });
           return false;
       });





</script>

</body>

 
    


<script src="{% static 'assets/js/jquery-1.10.2.js' %}"></script>
<!-- Bootstrap Js -->
<script src="{% static 'assets/js/bootstrap.min.js' %}"></script>

<!-- Metis Menu Js -->
<script src="{% static 'assets/js/jquery.metisMenu.js' %}"></script>

<script src="{% static 'assets/js/easypiechart.js' %}"></script>
<script src="{% static 'assets/js/easypiechart-data.js' %}"></script>
<script src="{% static 'assets/js/Lightweight-Chart/jquery.chart.js' %}"></script>

<!-- Custom Js -->
<script src="{% static 'assets/js/custom-scripts.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDCn8TFXGg17HAUcNpkwtxxyT9Io9B_NcM"
			defer></script>
		<script src="{% static 'assets-analytics/plugins/jquery/jquery.min.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/bootstrap/js/bootstrap.bundle.min.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/toaster/toastr.min.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/slimscrollbar/jquery.slimscroll.min.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/charts/Chart.min.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/ladda/spin.min.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/ladda/ladda.min.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/jquery-mask-input/jquery.mask.min.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/select2/js/select2.min.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/jvectormap/jquery-jvectormap-2.0.3.min.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/jvectormap/jquery-jvectormap-world-mill.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/daterangepicker/moment.min.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/daterangepicker/daterangepicker.js'%}"></script>
		<script src="{% static 'assets-analytics/plugins/jekyll-search.min.js'%}"></script>
		<script src="{% static 'assets-analytics/js/sleek.js'%}"></script>
		<script src="{% static 'assets-analytics/js/chart.js'%}"></script>
		<script src="{% static 'assets-analytics/js/date-range.js'%}"></script>
		<script src="{% static 'assets-analytics/js/map.js'%}"></script>
		<script src="{% static 'assets-analytics/js/custom.js'%}"></script>

</html>